"use strict";angular.module("unsavedChanges",["resettable"]).constant("_",_).provider("unsavedWarningsConfig",function(){var g=this;var e=false;var b=true;var d=["$locationChangeStart","$stateChangeStart"];var c="You will lose unsaved changes if you leave this page";var a="You will lose unsaved changes if you reload this page";var f;Object.defineProperty(g,"navigateMessage",{get:function(){return c},set:function(h){c=h}});Object.defineProperty(g,"reloadMessage",{get:function(){return a},set:function(h){a=h}});Object.defineProperty(g,"useTranslateService",{get:function(){return b},set:function(h){b=!!(h)}});Object.defineProperty(g,"routeEvent",{get:function(){return d},set:function(h){if(typeof h==="string"){h=[h]}d=h}});Object.defineProperty(g,"logEnabled",{get:function(){return e},set:function(h){e=!!(h)}});Object.defineProperty(g,"onNavigate",{get:function(){return f},set:function(h){f=h}});this.$get=["$injector",function(i){function j(k){if(i.has("$translate")&&b){return i.get("$translate").instant(k)}else{return false}}var h={log:function(){if(console.log&&e&&arguments.length){var k=[].slice.call(arguments);if(typeof console.log==="object"){log.apply.call(console.log,console,k)}else{console.log.apply(console,k)}}}};Object.defineProperty(h,"useTranslateService",{get:function(){return b}});Object.defineProperty(h,"reloadMessage",{get:function(){return j(a)||a}});Object.defineProperty(h,"navigateMessage",{get:function(){return j(c)||c}});Object.defineProperty(h,"routeEvent",{get:function(){return d}});Object.defineProperty(h,"logEnabled",{get:function(){return e}});Object.defineProperty(h,"onNavigate",{get:function(){return f},set:function(k){f=k}});return h}]}).service("unsavedWarningSharedService",["$rootScope","unsavedWarningsConfig","$injector","$window","$state",function(k,d,l,e,b){var j=this;var a=[];var h=true;var f=[];this.allForms=function(){return a};function i(){h=true;angular.forEach(a,function(n,m){d.log("Form : "+n.$name+" dirty : "+n.$dirty);if(n.$dirty){h=false}});return h}this.init=function(m){if(a.length===0){g()}d.log("Registering form",m);a.push(m)};this.removeForm=function(n){var m=a.indexOf(n);if(m===-1){return}a.splice(m,1);d.log("Removing form from watch list",n);if(a.length===0){c()}};function c(){d.log("No more forms, tearing down");angular.forEach(f,function(m){m()});f=[];e.onbeforeunload=null}this.confirmExit=function(){if(!i()){return d.reloadMessage}k.$broadcast("resetResettables");c()};function g(){d.log("Setting up");e.onbeforeunload=j.confirmExit;var n=d.routeEvent;var m=false;angular.forEach(n,function(o){var p=k.$on(o,function(s,r,q){d.log("user is moving with "+o);if(!i()){d.log("a form is dirty");if(d.onNavigate){if(!m){s.preventDefault();d.onNavigate(s,r,q).then(function(){k.$broadcast("resetResettables");q=q||{};m=true;b.go(r.name,q);d.log("user wants to cancel leaving")},function(){d.log("user doesn't care about loosing stuff")})}else{m=true}}else{if(!confirm(d.navigateMessage)){d.log("user wants to cancel leaving");s.preventDefault()}else{d.log("user doesn't care about loosing stuff");k.$broadcast("resetResettables")}}}else{d.log("all forms are clean")}});f.push(p)})}}]).directive("unsavedWarningClear",["unsavedWarningSharedService",function(a){return{scope:{},require:"^form",priority:10,link:function(d,c,b,e){c.bind("click",function(f){e.$setPristine()})}}}]).directive("unsavedWarningForm",["unsavedWarningSharedService","$rootScope","_",function(c,a,b){return{scope:{},require:"^form",link:function(f,e,d,h){var g=0;while(g<3&&e[0].tagName!=="FORM"&&!b.findWhere(b.values(e[0].attributes),{name:"ng-form"})){g++;e=e.parent()}if(g>=3){throw ("unsavedWarningForm must be inside a form element")}c.init(h);e.bind("submit",function(i){if(h.$valid){h.$setPristine()}});e.bind("reset",function(i){i.preventDefault();var j=angular.element(e[0].querySelector("[resettable]"));if(j.length){f.$apply(j.triggerHandler("resetResettables"))}h.$setPristine()});f.$on("$destroy",function(){c.removeForm(h)})}}}]);angular.module("resettable",[]).directive("resettable",["$parse","$compile","$rootScope",function(d,c,b){return{restrict:"A",link:function a(m,g,j,e){var h,k,l;j.$observe("ngModel",function(n){k=d(j.ngModel);h=k.assign;l=k(m)});var i=function(){h(m,l)};g.on("resetResettables",i);var f=m.$on("resetResettables",i);m.$on("$destroy",f)}}}]);